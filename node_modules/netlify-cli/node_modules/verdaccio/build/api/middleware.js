"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LOG_VERDACCIO_ERROR = exports.LOG_VERDACCIO_BYTES = exports.LOG_STATUS_MESSAGE = void 0;
exports.allow = allow;
exports.antiLoop = antiLoop;
exports.encodeScopePackage = encodeScopePackage;
exports.errorReportingMiddleware = errorReportingMiddleware;
exports.expectJson = expectJson;
exports.final = final;
exports.log = log;
exports.match = match;
exports.media = media;
exports.serveFavicon = serveFavicon;
exports.setSecurityWebHeaders = setSecurityWebHeaders;
exports.validateName = validateName;
exports.validatePackage = validatePackage;

var _debug = _interopRequireDefault(require("debug"));

var _fs = _interopRequireDefault(require("fs"));

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _validator = _interopRequireDefault(require("validator"));

var _constants = require("../lib/constants");

var _cryptoUtils = require("../lib/crypto-utils");

var _logger = require("../lib/logger");

var _utils = require("../lib/utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const debug = (0, _debug.default)('verdaccio');

function match(regexp) {
  return function (req, res, next, value) {
    if (regexp.exec(value)) {
      next();
    } else {
      next('route');
    }
  };
}

function serveFavicon(config) {
  return function (req, res, next) {
    try {
      var _config$web;

      // @ts-ignore
      const logoConf = config === null || config === void 0 ? void 0 : (_config$web = config.web) === null || _config$web === void 0 ? void 0 : _config$web.favicon;

      if (logoConf === '') {
        debug('favicon disabled');
        res.status(404);
      } else if (!_lodash.default.isEmpty(logoConf)) {
        debug('custom favicon');

        if (_validator.default.isURL(logoConf, {
          require_host: true,
          require_valid_protocol: true
        })) {
          debug('redirect to %o', logoConf);
          res.redirect(logoConf);
          return;
        } else {
          const faviconPath = _path.default.normalize(logoConf);

          debug('serving favicon from %o', faviconPath);

          _fs.default.access(faviconPath, _fs.default.constants.R_OK, err => {
            if (err) {
              debug('no read permissions to read: %o, reason:', logoConf, err === null || err === void 0 ? void 0 : err.message);
              return res.status(_constants.HTTP_STATUS.NOT_FOUND).end();
            } else {
              res.setHeader('content-type', 'image/x-icon');

              _fs.default.createReadStream(faviconPath).pipe(res);

              debug('rendered custom ico');
            }
          });
        }
      } else {
        res.setHeader('content-type', 'image/x-icon');

        _fs.default.createReadStream(_path.default.posix.join(__dirname, './web/html/favicon.ico')).pipe(res);

        debug('rendered ico');
      }
    } catch (err) {
      debug('error triggered, favicon not found');
      res.status(_constants.HTTP_STATUS.NOT_FOUND).end();
    }
  };
}

function setSecurityWebHeaders(req, res, next) {
  // disable loading in frames (clickjacking, etc.)
  res.header(_constants.HEADERS.FRAMES_OPTIONS, 'deny'); // avoid stablish connections outside of domain

  res.header(_constants.HEADERS.CSP, "connect-src 'self'"); // https://stackoverflow.com/questions/18337630/what-is-x-content-type-options-nosniff

  res.header(_constants.HEADERS.CTO, 'nosniff'); // https://stackoverflow.com/questions/9090577/what-is-the-http-header-x-xss-protection

  res.header(_constants.HEADERS.XSS, '1; mode=block');
  next();
} // flow: express does not match properly
// flow info https://github.com/flowtype/flow-typed/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+express


function validateName(req, res, next, value, name) {
  if (value === '-') {
    // special case in couchdb usually
    next('route');
  } else if ((0, _utils.validateName)(value)) {
    next();
  } else {
    next(_utils.ErrorCode.getForbidden('invalid ' + name));
  }
} // flow: express does not match properly
// flow info https://github.com/flowtype/flow-typed/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+express


function validatePackage(req, res, next, value, name) {
  if (value === '-') {
    // special case in couchdb usually
    next('route');
  } else if ((0, _utils.validatePackage)(value)) {
    next();
  } else {
    next(_utils.ErrorCode.getForbidden('invalid ' + name));
  }
}

function media(expect) {
  return function (req, res, next) {
    if (req.headers[_constants.HEADER_TYPE.CONTENT_TYPE] !== expect) {
      next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.UNSUPPORTED_MEDIA, 'wrong content-type, expect: ' + expect + ', got: ' + req.get(_constants.HEADER_TYPE.CONTENT_TYPE)));
    } else {
      next();
    }
  };
}

function encodeScopePackage(req, res, next) {
  if (req.url.indexOf('@') !== -1) {
    // e.g.: /@org/pkg/1.2.3 -> /@org%2Fpkg/1.2.3, /@org%2Fpkg/1.2.3 -> /@org%2Fpkg/1.2.3
    req.url = req.url.replace(/^(\/@[^\/%]+)\/(?!$)/, '$1%2F');
  }

  next();
}

function expectJson(req, res, next) {
  if (!(0, _utils.isObject)(req.body)) {
    return next(_utils.ErrorCode.getBadRequest("can't parse incoming json"));
  }

  next();
}

function antiLoop(config) {
  return function (req, res, next) {
    var _req$headers;

    if ((req === null || req === void 0 ? void 0 : (_req$headers = req.headers) === null || _req$headers === void 0 ? void 0 : _req$headers.via) != null) {
      const arr = req.headers.via.split(',');

      for (let i = 0; i < arr.length; i++) {
        const m = arr[i].match(/\s*(\S+)\s+(\S+)/);

        if (m && m[2] === config.server_id) {
          return next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.LOOP_DETECTED, 'loop detected'));
        }
      }
    }

    next();
  };
}

function allow(auth) {
  return function (action) {
    return function (req, res, next) {
      req.pause();
      const packageName = req.params.scope ? `@${req.params.scope}/${req.params.package}` : req.params.package;
      let packageVersion = undefined;

      if (req.params.filename) {
        packageVersion = (0, _utils.getVersionFromTarball)(req.params.filename) || undefined;
      } else if (typeof req.body.versions === 'object') {
        packageVersion = Object.keys(req.body.versions)[0];
      }

      const remote = req.remote_user;
      debug('[middleware/allow][%o] allow for %o', action, remote === null || remote === void 0 ? void 0 : remote.name);
      auth['allow_' + action]({
        packageName,
        packageVersion
      }, remote, function (error, allowed) {
        req.resume();

        if (error) {
          next(error);
        } else if (allowed) {
          next();
        } else {
          // last plugin (that's our built-in one) returns either
          // cb(err) or cb(null, true), so this should never happen
          throw _utils.ErrorCode.getInternalError(_constants.API_ERROR.PLUGIN_ERROR);
        }
      });
    };
  };
}

function final(body, req, res, next) {
  if (res.statusCode === _constants.HTTP_STATUS.UNAUTHORIZED && !res.getHeader(_constants.HEADERS.WWW_AUTH)) {
    // they say it's required for 401, so...
    res.header(_constants.HEADERS.WWW_AUTH, `${_constants.TOKEN_BASIC}, ${_constants.TOKEN_BEARER}`);
  }

  try {
    if (_lodash.default.isString(body) || _lodash.default.isObject(body)) {
      if (!res.getHeader(_constants.HEADERS.CONTENT_TYPE)) {
        res.header(_constants.HEADERS.CONTENT_TYPE, _constants.HEADERS.JSON);
      }

      if (typeof body === 'object' && _lodash.default.isNil(body) === false) {
        if (typeof body.error === 'string') {
          res.locals._verdaccio_error = body.error;
        }

        body = JSON.stringify(body);
      } // don't send etags with errors


      if (!res.statusCode || res.statusCode >= _constants.HTTP_STATUS.OK && res.statusCode < _constants.HTTP_STATUS.MULTIPLE_CHOICES) {
        res.header(_constants.HEADERS.ETAG, '"' + (0, _cryptoUtils.stringToMD5)(body) + '"');
      }
    } else {// send(null), send(204), etc.
    }
  } catch (err) {
    // if verdaccio sends headers first, and then calls res.send()
    // as an error handler, we can't report error properly,
    // and should just close socket
    if (err.message.match(/set headers after they are sent/)) {
      if (_lodash.default.isNil(res.socket) === false) {
        // @ts-ignore
        res.socket.destroy();
      }

      return;
    }

    throw err;
  }

  res.send(body);
}

const LOG_STATUS_MESSAGE = "@{status}, user: @{user}(@{remoteIP}), req: '@{request.method} @{request.url}'";
exports.LOG_STATUS_MESSAGE = LOG_STATUS_MESSAGE;
const LOG_VERDACCIO_ERROR = `${LOG_STATUS_MESSAGE}, error: @{!error}`;
exports.LOG_VERDACCIO_ERROR = LOG_VERDACCIO_ERROR;
const LOG_VERDACCIO_BYTES = `${LOG_STATUS_MESSAGE}, bytes: @{bytes.in}/@{bytes.out}`;
exports.LOG_VERDACCIO_BYTES = LOG_VERDACCIO_BYTES;

function log(config) {
  return function (req, res, next) {
    var _config$experiments;

    const _auth = req.headers.authorization;

    if (_lodash.default.isNil(_auth) === false) {
      req.headers.authorization = '<Classified>';
    }

    const _cookie = req.get('cookie');

    if (_lodash.default.isNil(_cookie) === false) {
      req.headers.cookie = '<Classified>';
    }

    req.url = req.originalUrl; // avoid log noise data from static content

    if (req.originalUrl.match(/static/) === null) {
      _logger.logger.http({
        req: req,
        ip: req.ip
      }, "@{ip} requested '@{req.method} @{req.url}'");
    }

    req.originalUrl = req.url;

    if (_lodash.default.isNil(_auth) === false) {
      req.headers.authorization = _auth;
    }

    if (_lodash.default.isNil(_cookie) === false) {
      req.headers.cookie = _cookie;
    }

    let bytesin = 0;

    if ((config === null || config === void 0 ? void 0 : (_config$experiments = config.experiments) === null || _config$experiments === void 0 ? void 0 : _config$experiments.bytesin_off) !== true) {
      req.on('data', function (chunk) {
        bytesin += chunk.length;
      });
    }

    let bytesout = 0;
    const _write = res.write; // FIXME: res.write should return boolean
    // @ts-ignore

    res.write = function (buf) {
      bytesout += buf.length;
      /* eslint prefer-rest-params: "off" */
      // @ts-ignore

      _write.apply(res, arguments);
    };

    let logHasBeenCalled = false;

    const log = function () {
      if (logHasBeenCalled) {
        return;
      }

      logHasBeenCalled = true;
      const forwardedFor = req.get('x-forwarded-for');
      const remoteAddress = req.connection.remoteAddress;
      const remoteIP = forwardedFor ? `${forwardedFor} via ${remoteAddress}` : remoteAddress;
      let message;

      if (res.locals._verdaccio_error) {
        message = LOG_VERDACCIO_ERROR;
      } else {
        message = LOG_VERDACCIO_BYTES;
      }

      req.url = req.originalUrl; // avoid log noise data from static content

      if (req.url.match(/static/) === null) {
        _logger.logger.http({
          request: {
            method: req.method,
            url: req.url
          },
          user: req.remote_user && req.remote_user.name || null,
          remoteIP,
          status: res.statusCode,
          error: res.locals._verdaccio_error,
          bytes: {
            in: bytesin,
            out: bytesout
          }
        }, message);

        req.originalUrl = req.url;
      }
    };

    req.on('close', function () {
      log();
    });
    const _end = res.end;

    res.end = function (buf) {
      if (buf) {
        bytesout += buf.length;
      }
      /* eslint prefer-rest-params: "off" */
      // @ts-ignore


      _end.apply(res, arguments);

      log();
    };

    next();
  };
} // Middleware


function errorReportingMiddleware(req, res, next) {
  res.locals.report_error = res.locals.report_error || function (err) {
    if (err.status && err.status >= _constants.HTTP_STATUS.BAD_REQUEST && err.status < 600) {
      if (!res.headersSent) {
        res.status(err.status);
        next({
          error: err.message || _constants.API_ERROR.UNKNOWN_ERROR
        });
      }
    } else {
      _logger.logger.error({
        err: err
      }, 'unexpected error: @{!err.message}\n@{err.stack}');

      if (!res.status || !res.send) {
        _logger.logger.error('this is an error in express.js, please report this');

        res.destroy();
      } else if (!res.headersSent) {
        res.status(_constants.HTTP_STATUS.INTERNAL_ERROR);
        next({
          error: _constants.API_ERROR.INTERNAL_SERVER_ERROR
        });
      } else {// socket should be already closed
      }
    }
  };

  next();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZWJ1ZyIsImJ1aWxkRGVidWciLCJtYXRjaCIsInJlZ2V4cCIsInJlcSIsInJlcyIsIm5leHQiLCJ2YWx1ZSIsImV4ZWMiLCJzZXJ2ZUZhdmljb24iLCJjb25maWciLCJsb2dvQ29uZiIsIndlYiIsImZhdmljb24iLCJzdGF0dXMiLCJfIiwiaXNFbXB0eSIsInZhbGlkYXRvciIsImlzVVJMIiwicmVxdWlyZV9ob3N0IiwicmVxdWlyZV92YWxpZF9wcm90b2NvbCIsInJlZGlyZWN0IiwiZmF2aWNvblBhdGgiLCJwYXRoIiwibm9ybWFsaXplIiwiZnMiLCJhY2Nlc3MiLCJjb25zdGFudHMiLCJSX09LIiwiZXJyIiwibWVzc2FnZSIsIkhUVFBfU1RBVFVTIiwiTk9UX0ZPVU5EIiwiZW5kIiwic2V0SGVhZGVyIiwiY3JlYXRlUmVhZFN0cmVhbSIsInBpcGUiLCJwb3NpeCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJzZXRTZWN1cml0eVdlYkhlYWRlcnMiLCJoZWFkZXIiLCJIRUFERVJTIiwiRlJBTUVTX09QVElPTlMiLCJDU1AiLCJDVE8iLCJYU1MiLCJ2YWxpZGF0ZU5hbWUiLCJuYW1lIiwidXRpbFZhbGlkYXRlTmFtZSIsIkVycm9yQ29kZSIsImdldEZvcmJpZGRlbiIsInZhbGlkYXRlUGFja2FnZSIsInV0aWxWYWxpZGF0ZVBhY2thZ2UiLCJtZWRpYSIsImV4cGVjdCIsImhlYWRlcnMiLCJIRUFERVJfVFlQRSIsIkNPTlRFTlRfVFlQRSIsImdldENvZGUiLCJVTlNVUFBPUlRFRF9NRURJQSIsImdldCIsImVuY29kZVNjb3BlUGFja2FnZSIsInVybCIsImluZGV4T2YiLCJyZXBsYWNlIiwiZXhwZWN0SnNvbiIsImlzT2JqZWN0IiwiYm9keSIsImdldEJhZFJlcXVlc3QiLCJhbnRpTG9vcCIsInZpYSIsImFyciIsInNwbGl0IiwiaSIsImxlbmd0aCIsIm0iLCJzZXJ2ZXJfaWQiLCJMT09QX0RFVEVDVEVEIiwiYWxsb3ciLCJhdXRoIiwiYWN0aW9uIiwicGF1c2UiLCJwYWNrYWdlTmFtZSIsInBhcmFtcyIsInNjb3BlIiwicGFja2FnZSIsInBhY2thZ2VWZXJzaW9uIiwidW5kZWZpbmVkIiwiZmlsZW5hbWUiLCJnZXRWZXJzaW9uRnJvbVRhcmJhbGwiLCJ2ZXJzaW9ucyIsIk9iamVjdCIsImtleXMiLCJyZW1vdGUiLCJyZW1vdGVfdXNlciIsImVycm9yIiwiYWxsb3dlZCIsInJlc3VtZSIsImdldEludGVybmFsRXJyb3IiLCJBUElfRVJST1IiLCJQTFVHSU5fRVJST1IiLCJmaW5hbCIsInN0YXR1c0NvZGUiLCJVTkFVVEhPUklaRUQiLCJnZXRIZWFkZXIiLCJXV1dfQVVUSCIsIlRPS0VOX0JBU0lDIiwiVE9LRU5fQkVBUkVSIiwiaXNTdHJpbmciLCJKU09OIiwiaXNOaWwiLCJsb2NhbHMiLCJfdmVyZGFjY2lvX2Vycm9yIiwic3RyaW5naWZ5IiwiT0siLCJNVUxUSVBMRV9DSE9JQ0VTIiwiRVRBRyIsInN0cmluZ1RvTUQ1Iiwic29ja2V0IiwiZGVzdHJveSIsInNlbmQiLCJMT0dfU1RBVFVTX01FU1NBR0UiLCJMT0dfVkVSREFDQ0lPX0VSUk9SIiwiTE9HX1ZFUkRBQ0NJT19CWVRFUyIsImxvZyIsIl9hdXRoIiwiYXV0aG9yaXphdGlvbiIsIl9jb29raWUiLCJjb29raWUiLCJvcmlnaW5hbFVybCIsImxvZ2dlciIsImh0dHAiLCJpcCIsImJ5dGVzaW4iLCJleHBlcmltZW50cyIsImJ5dGVzaW5fb2ZmIiwib24iLCJjaHVuayIsImJ5dGVzb3V0IiwiX3dyaXRlIiwid3JpdGUiLCJidWYiLCJhcHBseSIsImFyZ3VtZW50cyIsImxvZ0hhc0JlZW5DYWxsZWQiLCJmb3J3YXJkZWRGb3IiLCJyZW1vdGVBZGRyZXNzIiwiY29ubmVjdGlvbiIsInJlbW90ZUlQIiwicmVxdWVzdCIsIm1ldGhvZCIsInVzZXIiLCJieXRlcyIsImluIiwib3V0IiwiX2VuZCIsImVycm9yUmVwb3J0aW5nTWlkZGxld2FyZSIsInJlcG9ydF9lcnJvciIsIkJBRF9SRVFVRVNUIiwiaGVhZGVyc1NlbnQiLCJVTktOT1dOX0VSUk9SIiwiSU5URVJOQUxfRVJST1IiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvYXBpL21pZGRsZXdhcmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGJ1aWxkRGVidWcgZnJvbSAnZGVidWcnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB2YWxpZGF0b3IgZnJvbSAndmFsaWRhdG9yJztcblxuaW1wb3J0IHsgVmVyZGFjY2lvRXJyb3IgfSBmcm9tICdAdmVyZGFjY2lvL2NvbW1vbnMtYXBpJztcbmltcG9ydCB7IENvbmZpZywgUGFja2FnZSwgUmVtb3RlVXNlciB9IGZyb20gJ0B2ZXJkYWNjaW8vdHlwZXMnO1xuXG5pbXBvcnQgeyAkTmV4dEZ1bmN0aW9uVmVyLCAkUmVxdWVzdEV4dGVuZCwgJFJlc3BvbnNlRXh0ZW5kLCBJQXV0aCB9IGZyb20gJy4uLy4uL3R5cGVzJztcbmltcG9ydCB7IEFQSV9FUlJPUiwgSEVBREVSUywgSEVBREVSX1RZUEUsIEhUVFBfU1RBVFVTLCBUT0tFTl9CQVNJQywgVE9LRU5fQkVBUkVSIH0gZnJvbSAnLi4vbGliL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBzdHJpbmdUb01ENSB9IGZyb20gJy4uL2xpYi9jcnlwdG8tdXRpbHMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vbGliL2xvZ2dlcic7XG5pbXBvcnQgeyBFcnJvckNvZGUsIGdldFZlcnNpb25Gcm9tVGFyYmFsbCwgaXNPYmplY3QsIHZhbGlkYXRlTmFtZSBhcyB1dGlsVmFsaWRhdGVOYW1lLCB2YWxpZGF0ZVBhY2thZ2UgYXMgdXRpbFZhbGlkYXRlUGFja2FnZSB9IGZyb20gJy4uL2xpYi91dGlscyc7XG5cbmNvbnN0IGRlYnVnID0gYnVpbGREZWJ1ZygndmVyZGFjY2lvJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaChyZWdleHA6IFJlZ0V4cCk6IGFueSB7XG4gIHJldHVybiBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIsIHZhbHVlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAocmVnZXhwLmV4ZWModmFsdWUpKSB7XG4gICAgICBuZXh0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5leHQoJ3JvdXRlJyk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2VydmVGYXZpY29uKGNvbmZpZzogQ29uZmlnKSB7XG4gIHJldHVybiBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpIHtcbiAgICB0cnkge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgY29uc3QgbG9nb0NvbmY6IHN0cmluZyA9IGNvbmZpZz8ud2ViPy5mYXZpY29uIGFzIHN0cmluZztcbiAgICAgIGlmIChsb2dvQ29uZiA9PT0gJycpIHtcbiAgICAgICAgZGVidWcoJ2Zhdmljb24gZGlzYWJsZWQnKTtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDQpO1xuICAgICAgfSBlbHNlIGlmICghXy5pc0VtcHR5KGxvZ29Db25mKSkge1xuICAgICAgICBkZWJ1ZygnY3VzdG9tIGZhdmljb24nKTtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHZhbGlkYXRvci5pc1VSTChsb2dvQ29uZiwge1xuICAgICAgICAgICAgcmVxdWlyZV9ob3N0OiB0cnVlLFxuICAgICAgICAgICAgcmVxdWlyZV92YWxpZF9wcm90b2NvbDogdHJ1ZSxcbiAgICAgICAgICB9KVxuICAgICAgICApIHtcbiAgICAgICAgICBkZWJ1ZygncmVkaXJlY3QgdG8gJW8nLCBsb2dvQ29uZik7XG4gICAgICAgICAgcmVzLnJlZGlyZWN0KGxvZ29Db25mKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZmF2aWNvblBhdGggPSBwYXRoLm5vcm1hbGl6ZShsb2dvQ29uZik7XG4gICAgICAgICAgZGVidWcoJ3NlcnZpbmcgZmF2aWNvbiBmcm9tICVvJywgZmF2aWNvblBhdGgpO1xuICAgICAgICAgIGZzLmFjY2VzcyhmYXZpY29uUGF0aCwgZnMuY29uc3RhbnRzLlJfT0ssIChlcnIpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgZGVidWcoJ25vIHJlYWQgcGVybWlzc2lvbnMgdG8gcmVhZDogJW8sIHJlYXNvbjonLCBsb2dvQ29uZiwgZXJyPy5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKS5lbmQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ2NvbnRlbnQtdHlwZScsICdpbWFnZS94LWljb24nKTtcbiAgICAgICAgICAgICAgZnMuY3JlYXRlUmVhZFN0cmVhbShmYXZpY29uUGF0aCkucGlwZShyZXMpO1xuICAgICAgICAgICAgICBkZWJ1ZygncmVuZGVyZWQgY3VzdG9tIGljbycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc2V0SGVhZGVyKCdjb250ZW50LXR5cGUnLCAnaW1hZ2UveC1pY29uJyk7XG4gICAgICAgIGZzLmNyZWF0ZVJlYWRTdHJlYW0ocGF0aC5wb3NpeC5qb2luKF9fZGlybmFtZSwgJy4vd2ViL2h0bWwvZmF2aWNvbi5pY28nKSkucGlwZShyZXMpO1xuICAgICAgICBkZWJ1ZygncmVuZGVyZWQgaWNvJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBkZWJ1ZygnZXJyb3IgdHJpZ2dlcmVkLCBmYXZpY29uIG5vdCBmb3VuZCcpO1xuICAgICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5OT1RfRk9VTkQpLmVuZCgpO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldFNlY3VyaXR5V2ViSGVhZGVycyhyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAvLyBkaXNhYmxlIGxvYWRpbmcgaW4gZnJhbWVzIChjbGlja2phY2tpbmcsIGV0Yy4pXG4gIHJlcy5oZWFkZXIoSEVBREVSUy5GUkFNRVNfT1BUSU9OUywgJ2RlbnknKTtcbiAgLy8gYXZvaWQgc3RhYmxpc2ggY29ubmVjdGlvbnMgb3V0c2lkZSBvZiBkb21haW5cbiAgcmVzLmhlYWRlcihIRUFERVJTLkNTUCwgXCJjb25uZWN0LXNyYyAnc2VsZidcIik7XG4gIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4MzM3NjMwL3doYXQtaXMteC1jb250ZW50LXR5cGUtb3B0aW9ucy1ub3NuaWZmXG4gIHJlcy5oZWFkZXIoSEVBREVSUy5DVE8sICdub3NuaWZmJyk7XG4gIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzkwOTA1Nzcvd2hhdC1pcy10aGUtaHR0cC1oZWFkZXIteC14c3MtcHJvdGVjdGlvblxuICByZXMuaGVhZGVyKEhFQURFUlMuWFNTLCAnMTsgbW9kZT1ibG9jaycpO1xuICBuZXh0KCk7XG59XG5cbi8vIGZsb3c6IGV4cHJlc3MgZG9lcyBub3QgbWF0Y2ggcHJvcGVybHlcbi8vIGZsb3cgaW5mbyBodHRwczovL2dpdGh1Yi5jb20vZmxvd3R5cGUvZmxvdy10eXBlZC9pc3N1ZXM/dXRmOD0lRTIlOUMlOTMmcT1pcyUzQWlzc3VlK2lzJTNBb3BlbitleHByZXNzXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVOYW1lKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyLCB2YWx1ZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgaWYgKHZhbHVlID09PSAnLScpIHtcbiAgICAvLyBzcGVjaWFsIGNhc2UgaW4gY291Y2hkYiB1c3VhbGx5XG4gICAgbmV4dCgncm91dGUnKTtcbiAgfSBlbHNlIGlmICh1dGlsVmFsaWRhdGVOYW1lKHZhbHVlKSkge1xuICAgIG5leHQoKTtcbiAgfSBlbHNlIHtcbiAgICBuZXh0KEVycm9yQ29kZS5nZXRGb3JiaWRkZW4oJ2ludmFsaWQgJyArIG5hbWUpKTtcbiAgfVxufVxuXG4vLyBmbG93OiBleHByZXNzIGRvZXMgbm90IG1hdGNoIHByb3Blcmx5XG4vLyBmbG93IGluZm8gaHR0cHM6Ly9naXRodWIuY29tL2Zsb3d0eXBlL2Zsb3ctdHlwZWQvaXNzdWVzP3V0Zjg9JUUyJTlDJTkzJnE9aXMlM0Fpc3N1ZStpcyUzQW9wZW4rZXhwcmVzc1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGFja2FnZShyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlciwgdmFsdWU6IHN0cmluZywgbmFtZTogc3RyaW5nKTogdm9pZCB7XG4gIGlmICh2YWx1ZSA9PT0gJy0nKSB7XG4gICAgLy8gc3BlY2lhbCBjYXNlIGluIGNvdWNoZGIgdXN1YWxseVxuICAgIG5leHQoJ3JvdXRlJyk7XG4gIH0gZWxzZSBpZiAodXRpbFZhbGlkYXRlUGFja2FnZSh2YWx1ZSkpIHtcbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgbmV4dChFcnJvckNvZGUuZ2V0Rm9yYmlkZGVuKCdpbnZhbGlkICcgKyBuYW1lKSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lZGlhKGV4cGVjdDogc3RyaW5nIHwgbnVsbCk6IGFueSB7XG4gIHJldHVybiBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgICBpZiAocmVxLmhlYWRlcnNbSEVBREVSX1RZUEUuQ09OVEVOVF9UWVBFXSAhPT0gZXhwZWN0KSB7XG4gICAgICBuZXh0KEVycm9yQ29kZS5nZXRDb2RlKEhUVFBfU1RBVFVTLlVOU1VQUE9SVEVEX01FRElBLCAnd3JvbmcgY29udGVudC10eXBlLCBleHBlY3Q6ICcgKyBleHBlY3QgKyAnLCBnb3Q6ICcgKyByZXEuZ2V0KEhFQURFUl9UWVBFLkNPTlRFTlRfVFlQRSkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV4dCgpO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuY29kZVNjb3BlUGFja2FnZShyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICBpZiAocmVxLnVybC5pbmRleE9mKCdAJykgIT09IC0xKSB7XG4gICAgLy8gZS5nLjogL0BvcmcvcGtnLzEuMi4zIC0+IC9Ab3JnJTJGcGtnLzEuMi4zLCAvQG9yZyUyRnBrZy8xLjIuMyAtPiAvQG9yZyUyRnBrZy8xLjIuM1xuICAgIHJlcS51cmwgPSByZXEudXJsLnJlcGxhY2UoL14oXFwvQFteXFwvJV0rKVxcLyg/ISQpLywgJyQxJTJGJyk7XG4gIH1cbiAgbmV4dCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXhwZWN0SnNvbihyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICBpZiAoIWlzT2JqZWN0KHJlcS5ib2R5KSkge1xuICAgIHJldHVybiBuZXh0KEVycm9yQ29kZS5nZXRCYWRSZXF1ZXN0KFwiY2FuJ3QgcGFyc2UgaW5jb21pbmcganNvblwiKSk7XG4gIH1cbiAgbmV4dCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYW50aUxvb3AoY29uZmlnOiBDb25maWcpOiBGdW5jdGlvbiB7XG4gIHJldHVybiBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgICBpZiAocmVxPy5oZWFkZXJzPy52aWEgIT0gbnVsbCkge1xuICAgICAgY29uc3QgYXJyID0gcmVxLmhlYWRlcnMudmlhLnNwbGl0KCcsJyk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IG0gPSBhcnJbaV0ubWF0Y2goL1xccyooXFxTKylcXHMrKFxcUyspLyk7XG4gICAgICAgIGlmIChtICYmIG1bMl0gPT09IGNvbmZpZy5zZXJ2ZXJfaWQpIHtcbiAgICAgICAgICByZXR1cm4gbmV4dChFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5MT09QX0RFVEVDVEVELCAnbG9vcCBkZXRlY3RlZCcpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBuZXh0KCk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhbGxvdyhhdXRoOiBJQXV0aCk6IEZ1bmN0aW9uIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChhY3Rpb246IHN0cmluZyk6IEZ1bmN0aW9uIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICByZXEucGF1c2UoKTtcbiAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gcmVxLnBhcmFtcy5zY29wZSA/IGBAJHtyZXEucGFyYW1zLnNjb3BlfS8ke3JlcS5wYXJhbXMucGFja2FnZX1gIDogcmVxLnBhcmFtcy5wYWNrYWdlO1xuICAgICAgbGV0IHBhY2thZ2VWZXJzaW9uOiBzdHJpbmcgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gICAgICBpZiAocmVxLnBhcmFtcy5maWxlbmFtZSkge1xuICAgICAgICBwYWNrYWdlVmVyc2lvbiA9IGdldFZlcnNpb25Gcm9tVGFyYmFsbChyZXEucGFyYW1zLmZpbGVuYW1lKSB8fCB1bmRlZmluZWQ7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXEuYm9keS52ZXJzaW9ucyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcGFja2FnZVZlcnNpb24gPSBPYmplY3Qua2V5cyhyZXEuYm9keS52ZXJzaW9ucylbMF07XG4gICAgICB9XG4gICAgICBjb25zdCByZW1vdGU6IFJlbW90ZVVzZXIgPSByZXEucmVtb3RlX3VzZXI7XG4gICAgICBkZWJ1ZygnW21pZGRsZXdhcmUvYWxsb3ddWyVvXSBhbGxvdyBmb3IgJW8nLCBhY3Rpb24sIHJlbW90ZT8ubmFtZSk7XG4gICAgICBhdXRoWydhbGxvd18nICsgYWN0aW9uXSh7IHBhY2thZ2VOYW1lLCBwYWNrYWdlVmVyc2lvbiB9LCByZW1vdGUsIGZ1bmN0aW9uIChlcnJvciwgYWxsb3dlZCk6IHZvaWQge1xuICAgICAgICByZXEucmVzdW1lKCk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgICB9IGVsc2UgaWYgKGFsbG93ZWQpIHtcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbGFzdCBwbHVnaW4gKHRoYXQncyBvdXIgYnVpbHQtaW4gb25lKSByZXR1cm5zIGVpdGhlclxuICAgICAgICAgIC8vIGNiKGVycikgb3IgY2IobnVsbCwgdHJ1ZSksIHNvIHRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlblxuICAgICAgICAgIHRocm93IEVycm9yQ29kZS5nZXRJbnRlcm5hbEVycm9yKEFQSV9FUlJPUi5QTFVHSU5fRVJST1IpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1pZGRsZXdhcmVFcnJvciB7XG4gIGVycm9yOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEZpbmFsQm9keSA9IFBhY2thZ2UgfCBNaWRkbGV3YXJlRXJyb3IgfCBzdHJpbmc7XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5hbChib2R5OiBGaW5hbEJvZHksIHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gSFRUUF9TVEFUVVMuVU5BVVRIT1JJWkVEICYmICFyZXMuZ2V0SGVhZGVyKEhFQURFUlMuV1dXX0FVVEgpKSB7XG4gICAgLy8gdGhleSBzYXkgaXQncyByZXF1aXJlZCBmb3IgNDAxLCBzby4uLlxuICAgIHJlcy5oZWFkZXIoSEVBREVSUy5XV1dfQVVUSCwgYCR7VE9LRU5fQkFTSUN9LCAke1RPS0VOX0JFQVJFUn1gKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgaWYgKF8uaXNTdHJpbmcoYm9keSkgfHwgXy5pc09iamVjdChib2R5KSkge1xuICAgICAgaWYgKCFyZXMuZ2V0SGVhZGVyKEhFQURFUlMuQ09OVEVOVF9UWVBFKSkge1xuICAgICAgICByZXMuaGVhZGVyKEhFQURFUlMuQ09OVEVOVF9UWVBFLCBIRUFERVJTLkpTT04pO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnICYmIF8uaXNOaWwoYm9keSkgPT09IGZhbHNlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgKGJvZHkgYXMgTWlkZGxld2FyZUVycm9yKS5lcnJvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXMubG9jYWxzLl92ZXJkYWNjaW9fZXJyb3IgPSAoYm9keSBhcyBNaWRkbGV3YXJlRXJyb3IpLmVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICAgIH1cblxuICAgICAgLy8gZG9uJ3Qgc2VuZCBldGFncyB3aXRoIGVycm9yc1xuICAgICAgaWYgKCFyZXMuc3RhdHVzQ29kZSB8fCAocmVzLnN0YXR1c0NvZGUgPj0gSFRUUF9TVEFUVVMuT0sgJiYgcmVzLnN0YXR1c0NvZGUgPCBIVFRQX1NUQVRVUy5NVUxUSVBMRV9DSE9JQ0VTKSkge1xuICAgICAgICByZXMuaGVhZGVyKEhFQURFUlMuRVRBRywgJ1wiJyArIHN0cmluZ1RvTUQ1KGJvZHkgYXMgc3RyaW5nKSArICdcIicpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBzZW5kKG51bGwpLCBzZW5kKDIwNCksIGV0Yy5cbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIGlmIHZlcmRhY2NpbyBzZW5kcyBoZWFkZXJzIGZpcnN0LCBhbmQgdGhlbiBjYWxscyByZXMuc2VuZCgpXG4gICAgLy8gYXMgYW4gZXJyb3IgaGFuZGxlciwgd2UgY2FuJ3QgcmVwb3J0IGVycm9yIHByb3Blcmx5LFxuICAgIC8vIGFuZCBzaG91bGQganVzdCBjbG9zZSBzb2NrZXRcbiAgICBpZiAoZXJyLm1lc3NhZ2UubWF0Y2goL3NldCBoZWFkZXJzIGFmdGVyIHRoZXkgYXJlIHNlbnQvKSkge1xuICAgICAgaWYgKF8uaXNOaWwocmVzLnNvY2tldCkgPT09IGZhbHNlKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmVzLnNvY2tldC5kZXN0cm95KCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRocm93IGVycjtcbiAgfVxuXG4gIHJlcy5zZW5kKGJvZHkpO1xufVxuXG5leHBvcnQgY29uc3QgTE9HX1NUQVRVU19NRVNTQUdFID0gXCJAe3N0YXR1c30sIHVzZXI6IEB7dXNlcn0oQHtyZW1vdGVJUH0pLCByZXE6ICdAe3JlcXVlc3QubWV0aG9kfSBAe3JlcXVlc3QudXJsfSdcIjtcbmV4cG9ydCBjb25zdCBMT0dfVkVSREFDQ0lPX0VSUk9SID0gYCR7TE9HX1NUQVRVU19NRVNTQUdFfSwgZXJyb3I6IEB7IWVycm9yfWA7XG5leHBvcnQgY29uc3QgTE9HX1ZFUkRBQ0NJT19CWVRFUyA9IGAke0xPR19TVEFUVVNfTUVTU0FHRX0sIGJ5dGVzOiBAe2J5dGVzLmlufS9Ae2J5dGVzLm91dH1gO1xuXG5leHBvcnQgZnVuY3Rpb24gbG9nKGNvbmZpZzogQ29uZmlnKSB7XG4gIHJldHVybiBmdW5jdGlvbiAocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgICBjb25zdCBfYXV0aCA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb247XG4gICAgaWYgKF8uaXNOaWwoX2F1dGgpID09PSBmYWxzZSkge1xuICAgICAgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiA9ICc8Q2xhc3NpZmllZD4nO1xuICAgIH1cblxuICAgIGNvbnN0IF9jb29raWUgPSByZXEuZ2V0KCdjb29raWUnKTtcbiAgICBpZiAoXy5pc05pbChfY29va2llKSA9PT0gZmFsc2UpIHtcbiAgICAgIHJlcS5oZWFkZXJzLmNvb2tpZSA9ICc8Q2xhc3NpZmllZD4nO1xuICAgIH1cblxuICAgIHJlcS51cmwgPSByZXEub3JpZ2luYWxVcmw7XG4gICAgLy8gYXZvaWQgbG9nIG5vaXNlIGRhdGEgZnJvbSBzdGF0aWMgY29udGVudFxuICAgIGlmIChyZXEub3JpZ2luYWxVcmwubWF0Y2goL3N0YXRpYy8pID09PSBudWxsKSB7XG4gICAgICBsb2dnZXIuaHR0cCh7IHJlcTogcmVxLCBpcDogcmVxLmlwIH0sIFwiQHtpcH0gcmVxdWVzdGVkICdAe3JlcS5tZXRob2R9IEB7cmVxLnVybH0nXCIpO1xuICAgIH1cbiAgICByZXEub3JpZ2luYWxVcmwgPSByZXEudXJsO1xuXG4gICAgaWYgKF8uaXNOaWwoX2F1dGgpID09PSBmYWxzZSkge1xuICAgICAgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiA9IF9hdXRoO1xuICAgIH1cblxuICAgIGlmIChfLmlzTmlsKF9jb29raWUpID09PSBmYWxzZSkge1xuICAgICAgcmVxLmhlYWRlcnMuY29va2llID0gX2Nvb2tpZTtcbiAgICB9XG5cbiAgICBsZXQgYnl0ZXNpbiA9IDA7XG4gICAgaWYgKGNvbmZpZz8uZXhwZXJpbWVudHM/LmJ5dGVzaW5fb2ZmICE9PSB0cnVlKSB7XG4gICAgICByZXEub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspOiB2b2lkIHtcbiAgICAgICAgYnl0ZXNpbiArPSBjaHVuay5sZW5ndGg7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBsZXQgYnl0ZXNvdXQgPSAwO1xuICAgIGNvbnN0IF93cml0ZSA9IHJlcy53cml0ZTtcbiAgICAvLyBGSVhNRTogcmVzLndyaXRlIHNob3VsZCByZXR1cm4gYm9vbGVhblxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICByZXMud3JpdGUgPSBmdW5jdGlvbiAoYnVmKTogYm9vbGVhbiB7XG4gICAgICBieXRlc291dCArPSBidWYubGVuZ3RoO1xuICAgICAgLyogZXNsaW50IHByZWZlci1yZXN0LXBhcmFtczogXCJvZmZcIiAqL1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgX3dyaXRlLmFwcGx5KHJlcywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgbGV0IGxvZ0hhc0JlZW5DYWxsZWQgPSBmYWxzZTtcbiAgICBjb25zdCBsb2cgPSBmdW5jdGlvbiAoKTogdm9pZCB7XG4gICAgICBpZiAobG9nSGFzQmVlbkNhbGxlZCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsb2dIYXNCZWVuQ2FsbGVkID0gdHJ1ZTtcblxuICAgICAgY29uc3QgZm9yd2FyZGVkRm9yID0gcmVxLmdldCgneC1mb3J3YXJkZWQtZm9yJyk7XG4gICAgICBjb25zdCByZW1vdGVBZGRyZXNzID0gcmVxLmNvbm5lY3Rpb24ucmVtb3RlQWRkcmVzcztcbiAgICAgIGNvbnN0IHJlbW90ZUlQID0gZm9yd2FyZGVkRm9yID8gYCR7Zm9yd2FyZGVkRm9yfSB2aWEgJHtyZW1vdGVBZGRyZXNzfWAgOiByZW1vdGVBZGRyZXNzO1xuICAgICAgbGV0IG1lc3NhZ2U7XG4gICAgICBpZiAocmVzLmxvY2Fscy5fdmVyZGFjY2lvX2Vycm9yKSB7XG4gICAgICAgIG1lc3NhZ2UgPSBMT0dfVkVSREFDQ0lPX0VSUk9SO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWVzc2FnZSA9IExPR19WRVJEQUNDSU9fQllURVM7XG4gICAgICB9XG5cbiAgICAgIHJlcS51cmwgPSByZXEub3JpZ2luYWxVcmw7XG4gICAgICAvLyBhdm9pZCBsb2cgbm9pc2UgZGF0YSBmcm9tIHN0YXRpYyBjb250ZW50XG4gICAgICBpZiAocmVxLnVybC5tYXRjaCgvc3RhdGljLykgPT09IG51bGwpIHtcbiAgICAgICAgbG9nZ2VyLmh0dHAoXG4gICAgICAgICAge1xuICAgICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICAgICAgICAgIHVybDogcmVxLnVybCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1c2VyOiAocmVxLnJlbW90ZV91c2VyICYmIHJlcS5yZW1vdGVfdXNlci5uYW1lKSB8fCBudWxsLFxuICAgICAgICAgICAgcmVtb3RlSVAsXG4gICAgICAgICAgICBzdGF0dXM6IHJlcy5zdGF0dXNDb2RlLFxuICAgICAgICAgICAgZXJyb3I6IHJlcy5sb2NhbHMuX3ZlcmRhY2Npb19lcnJvcixcbiAgICAgICAgICAgIGJ5dGVzOiB7XG4gICAgICAgICAgICAgIGluOiBieXRlc2luLFxuICAgICAgICAgICAgICBvdXQ6IGJ5dGVzb3V0LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1lc3NhZ2VcbiAgICAgICAgKTtcbiAgICAgICAgcmVxLm9yaWdpbmFsVXJsID0gcmVxLnVybDtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmVxLm9uKCdjbG9zZScsIGZ1bmN0aW9uICgpOiB2b2lkIHtcbiAgICAgIGxvZygpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgX2VuZCA9IHJlcy5lbmQ7XG4gICAgcmVzLmVuZCA9IGZ1bmN0aW9uIChidWYpOiB2b2lkIHtcbiAgICAgIGlmIChidWYpIHtcbiAgICAgICAgYnl0ZXNvdXQgKz0gYnVmLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIC8qIGVzbGludCBwcmVmZXItcmVzdC1wYXJhbXM6IFwib2ZmXCIgKi9cbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIF9lbmQuYXBwbHkocmVzLCBhcmd1bWVudHMpO1xuICAgICAgbG9nKCk7XG4gICAgfTtcbiAgICBuZXh0KCk7XG4gIH07XG59XG5cbi8vIE1pZGRsZXdhcmVcbmV4cG9ydCBmdW5jdGlvbiBlcnJvclJlcG9ydGluZ01pZGRsZXdhcmUocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgcmVzLmxvY2Fscy5yZXBvcnRfZXJyb3IgPVxuICAgIHJlcy5sb2NhbHMucmVwb3J0X2Vycm9yIHx8XG4gICAgZnVuY3Rpb24gKGVycjogVmVyZGFjY2lvRXJyb3IpOiB2b2lkIHtcbiAgICAgIGlmIChlcnIuc3RhdHVzICYmIGVyci5zdGF0dXMgPj0gSFRUUF9TVEFUVVMuQkFEX1JFUVVFU1QgJiYgZXJyLnN0YXR1cyA8IDYwMCkge1xuICAgICAgICBpZiAoIXJlcy5oZWFkZXJzU2VudCkge1xuICAgICAgICAgIHJlcy5zdGF0dXMoZXJyLnN0YXR1cyk7XG4gICAgICAgICAgbmV4dCh7IGVycm9yOiBlcnIubWVzc2FnZSB8fCBBUElfRVJST1IuVU5LTk9XTl9FUlJPUiB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKHsgZXJyOiBlcnIgfSwgJ3VuZXhwZWN0ZWQgZXJyb3I6IEB7IWVyci5tZXNzYWdlfVxcbkB7ZXJyLnN0YWNrfScpO1xuICAgICAgICBpZiAoIXJlcy5zdGF0dXMgfHwgIXJlcy5zZW5kKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKCd0aGlzIGlzIGFuIGVycm9yIGluIGV4cHJlc3MuanMsIHBsZWFzZSByZXBvcnQgdGhpcycpO1xuICAgICAgICAgIHJlcy5kZXN0cm95KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXJlcy5oZWFkZXJzU2VudCkge1xuICAgICAgICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuSU5URVJOQUxfRVJST1IpO1xuICAgICAgICAgIG5leHQoeyBlcnJvcjogQVBJX0VSUk9SLklOVEVSTkFMX1NFUlZFUl9FUlJPUiB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBzb2NrZXQgc2hvdWxkIGJlIGFscmVhZHkgY2xvc2VkXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gIG5leHQoKTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFNQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLEtBQUssR0FBRyxJQUFBQyxjQUFBLEVBQVcsV0FBWCxDQUFkOztBQUVPLFNBQVNDLEtBQVQsQ0FBZUMsTUFBZixFQUFvQztFQUN6QyxPQUFPLFVBQVVDLEdBQVYsRUFBK0JDLEdBQS9CLEVBQXFEQyxJQUFyRCxFQUE2RUMsS0FBN0UsRUFBa0c7SUFDdkcsSUFBSUosTUFBTSxDQUFDSyxJQUFQLENBQVlELEtBQVosQ0FBSixFQUF3QjtNQUN0QkQsSUFBSTtJQUNMLENBRkQsTUFFTztNQUNMQSxJQUFJLENBQUMsT0FBRCxDQUFKO0lBQ0Q7RUFDRixDQU5EO0FBT0Q7O0FBRU0sU0FBU0csWUFBVCxDQUFzQkMsTUFBdEIsRUFBc0M7RUFDM0MsT0FBTyxVQUFVTixHQUFWLEVBQStCQyxHQUEvQixFQUFxREMsSUFBckQsRUFBNkU7SUFDbEYsSUFBSTtNQUFBOztNQUNGO01BQ0EsTUFBTUssUUFBZ0IsR0FBR0QsTUFBSCxhQUFHQSxNQUFILHNDQUFHQSxNQUFNLENBQUVFLEdBQVgsZ0RBQUcsWUFBYUMsT0FBdEM7O01BQ0EsSUFBSUYsUUFBUSxLQUFLLEVBQWpCLEVBQXFCO1FBQ25CWCxLQUFLLENBQUMsa0JBQUQsQ0FBTDtRQUNBSyxHQUFHLENBQUNTLE1BQUosQ0FBVyxHQUFYO01BQ0QsQ0FIRCxNQUdPLElBQUks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